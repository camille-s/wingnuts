{
    "schemaVersion": 2,
    "$schema": "https://schemas.runtipi.io/v2/dynamic-compose.json",
    "services": [
        {
            "name": "nominatim",
            "image": "mediagis/nominatim:5.1",
            "environment": [
                { "key": "PBF_URL", "value": "${PBF_URL}" },
                { "key": "REPLICATION_URL", "value": "${REPLICATION_URL}" },
                {
                    "key": "NOMINATIM_PASSWORD_FILE",
                    "value": "/run/secrets/nominatim_key"
                },
                { "key": "UPDATE_MODE", "value": "catch-up" },
                { "key": "IMPORT_STYLE", "value": "full" },
                { "key": "USER_UID", "value": "1000" },
                { "key": "USER_GID", "value": "1000" }
            ],
            "internalPort": 8080,
            "volumes": [
                {
                    "hostPath": "${APP_DATA_DIR}/data/nominatim-db/",
                    "containerPath": "/var/lib/postgresql/16/main",
                    "readOnly": false,
                    "shared": false,
                    "private": false
                }
            ],
            "shmSize": "1gb",
            "addPorts": [
                {
                    "containerPort": 8080,
                    "hostPort": 8080,
                    "tcp": true
                }
            ]
        },
        {
            "name": "nominatim-ui",
            "image": "ghcr.io/camille-s/nominatim-ui:0.1.0",
            "internalPort": 80,
            "dependsOn": {
                "nominatim": {
                    "condition": "service_started"
                }
            },
            "isMain": true,
            "addPorts": [
                {
                    "containerPort": 80,
                    "hostPort": 8089,
                    "tcp": true
                }
            ]
        }
    ]
}
